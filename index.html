<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WRAFF FORCE – Credential Verification Node</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="WRAFF FORCE K-9 Division Credential Verification Node – QR based operator validation.">
  <style>
    :root {
      --bg-main: #05070c;
      --bg-panel: #0d111a;
      --bg-panel-soft: #111725;
      --accent: #39b6ff;
      --accent-soft: rgba(57, 182, 255, 0.6);
      --accent-strong: #18e0ff;
      --danger: #ff4b81;
      --success: #31f28c;
      --text-main: #e3f0ff;
      --text-muted: #7c8ba5;
      --border-soft: #1a2333;
      --shadow-soft: 0 0 40px rgba(0, 0, 0, 0.65);
      --radius-lg: 18px;
      --radius-sm: 8px;
      --transition-fast: 0.2s ease-out;
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: var(--font-sans);
      background: radial-gradient(circle at top, #152033 0, #05070c 55%, #020308 100%);
      color: var(--text-main);
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .page-shell {
      width: 100%;
      max-width: 1120px;
      margin: 24px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    /* HEADER / TOPBAR */

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 14px 18px;
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, rgba(10, 17, 32, 0.9), rgba(7, 10, 20, 0.98));
      border: 1px solid rgba(57, 182, 255, 0.32);
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 14px;
      min-width: 0;
    }

    .logo-wrap {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffffff 0, #39b6ff 22%, #05070c 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 18px rgba(24, 224, 255, 0.65);
      overflow: hidden;
      flex-shrink: 0;
    }

    .logo-wrap img {
      width: 80%;
      height: 80%;
      object-fit: contain;
      filter: drop-shadow(0 0 6px rgba(0,0,0,0.9));
    }

    .topbar-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .topbar-title-main {
      font-size: 1rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--accent-strong);
      white-space: nowrap;
    }

    .topbar-title-sub {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .session-pill {
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(49, 242, 140, 0.75);
      color: var(--success);
      background: radial-gradient(circle, rgba(49, 242, 140, 0.15), transparent 70%);
    }

    .lang-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid rgba(57, 182, 255, 0.5);
      overflow: hidden;
    }

    .lang-btn {
      padding: 5px 12px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: none;
      outline: none;
      cursor: pointer;
      background: transparent;
      color: var(--text-muted);
      transition: background var(--transition-fast), color var(--transition-fast);
    }

    .lang-btn.active {
      background: linear-gradient(135deg, rgba(24, 224, 255, 0.25), rgba(57, 182, 255, 0.12));
      color: var(--accent-strong);
    }

    /* MAIN GRID */

    .main-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 18px;
    }

    @media (max-width: 880px) {
      .main-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .panel {
      background: radial-gradient(circle at top left, #1c2738 0, #05070c 65%);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 16px;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 0 0, rgba(57, 182, 255, 0.16) 0, transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .panel-header {
      position: relative;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 12px;
    }

    .panel-title {
      font-size: 0.92rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent-strong);
    }

    .panel-subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(57, 182, 255, 0.4);
      color: var(--accent-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    /* SCAN CONSOLE */

    .scan-console {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .scan-terminal {
      background: radial-gradient(circle at 20% 0, #111827 0, #05070c 75%);
      border-radius: var(--radius-sm);
      border: 1px solid #1f2a3d;
      padding: 12px 12px 10px;
      font-family: "Consolas", "SF Mono", ui-monospace, Menlo, Monaco, monospace;
      font-size: 0.78rem;
      color: #e2f7ff;
      min-height: 170px;
      max-height: 240px;
      overflow-y: auto;
      position: relative;
    }

    .scan-terminal::-webkit-scrollbar {
      width: 6px;
    }

    .scan-terminal::-webkit-scrollbar-thumb {
      background: #222f44;
      border-radius: 999px;
    }

    .scan-line {
      margin-bottom: 4px;
      white-space: nowrap;
    }

    .scan-line .prompt {
      color: var(--accent-soft);
    }

    .scan-line .value-ok {
      color: var(--success);
    }

    .scan-line .value-warn {
      color: #ffd86b;
    }

    .scan-line .value-fail {
      color: var(--danger);
    }

    .scan-terminal-footer {
      margin-top: 4px;
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .scan-bar-wrapper {
      margin-top: 4px;
      height: 5px;
      border-radius: 999px;
      background: #05070c;
      overflow: hidden;
      border: 1px solid #1a2333;
    }

    .scan-bar {
      height: 100%;
      width: 35%;
      background: linear-gradient(90deg, #18e0ff, #31f28c);
      transform: translateX(-100%);
      animation: scanBarIdle 3s ease-in-out infinite;
    }

    .scan-bar.active {
      animation: scanBarActive 1.4s ease-in-out infinite;
    }

    @keyframes scanBarIdle {
      0%   { transform: translateX(-100%); opacity: 0.3; }
      50%  { transform: translateX(10%); opacity: 0.7; }
      100% { transform: translateX(120%); opacity: 0.3; }
    }

    @keyframes scanBarActive {
      0%   { transform: translateX(-100%); opacity: 0.4; }
      50%  { transform: translateX(60%); opacity: 1; }
      100% { transform: translateX(120%); opacity: 0.4; }
    }

    /* RESULT PANEL */

    .result-panel {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .match-heading {
      font-size: 0.88rem;
      font-weight: 600;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--success);
    }

    .match-subline {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .match-heading-icon {
      display: inline-block;
      margin-right: 6px;
      font-size: 0.96rem;
    }

    .mini-profile {
      margin-top: 4px;
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 12px;
      align-items: center;
      background: radial-gradient(circle at top left, rgba(49, 242, 140, 0.12), rgba(5, 7, 12, 0.95));
      border-radius: var(--radius-sm);
      border: 1px solid rgba(49, 242, 140, 0.45);
      padding: 10px 12px;
    }

    @media (max-width: 460px) {
      .mini-profile {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .mini-avatar {
      width: 70px;
      height: 70px;
      border-radius: 16px;
      border: 1px solid rgba(57, 182, 255, 0.7);
      background: radial-gradient(circle at 20% 10%, #ffffff 0, #39b6ff 20%, #05070c 75%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 14px rgba(57, 182, 255, 0.5);
      overflow: hidden;
    }

    .mini-avatar img {
      width: 80%;
      height: 80%;
      object-fit: contain;
    }

    .mini-meta {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 4px 12px;
      font-size: 0.8rem;
    }

    @media (max-width: 520px) {
      .mini-meta {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .meta-label {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .meta-value {
      color: var(--text-main);
      font-weight: 500;
    }

    .meta-row {
      display: flex;
      flex-direction: column;
    }

    /* OPS HINT */

    .ops-hint {
      margin-top: 6px;
      background: radial-gradient(circle at top, rgba(57, 182, 255, 0.12), rgba(5, 7, 12, 0.96));
      border-radius: var(--radius-sm);
      border: 1px solid rgba(57, 182, 255, 0.35);
      padding: 8px 11px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .ops-hint-title {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent-strong);
      margin-bottom: 4px;
    }

    .ops-hint-text {
      line-height: 1.4;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .btn {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(57, 182, 255, 0.7);
      background: radial-gradient(circle at top, rgba(57, 182, 255, 0.15), rgba(5, 7, 12, 0.9));
      color: var(--accent-strong);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      text-decoration: none;
      cursor: pointer;
      overflow: hidden;
      transition: border var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast), background var(--transition-fast);
    }

    .btn:hover {
      box-shadow: 0 0 18px rgba(57, 182, 255, 0.65);
      transform: translateY(-1px);
      border-color: var(--accent-strong);
    }

    .btn-primary {
      background: radial-gradient(circle at top, rgba(49, 242, 140, 0.24), rgba(5, 7, 12, 0.9));
      border-color: rgba(49, 242, 140, 0.8);
      color: var(--success);
    }

    .btn-secondary {
      opacity: 0.86;
    }

    .btn-label {
      white-space: nowrap;
    }

    .btn-icon {
      font-size: 0.95rem;
    }

    /* Surveillance Feed */

    .surv-panel {
      margin-top: 10px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(57, 182, 255, 0.45);
      background: radial-gradient(circle at top, rgba(57, 182, 255, 0.12), rgba(5, 7, 12, 0.97));
      padding: 8px 10px 10px;
    }

    .surv-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .surv-label {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 0.7rem;
      color: var(--accent-strong);
    }

    .surv-tag {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .surv-frame {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid rgba(57, 182, 255, 0.6);
      background: #020617;
      min-height: 140px;
      box-shadow: 0 14px 32px rgba(0, 0, 0, 0.9);
    }

    .surv-frame img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: saturate(0.85) contrast(1.05);
    }

    .surv-overlay {
      position: absolute;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 4px 7px;
      font-size: 0.65rem;
      color: rgba(226, 232, 255, 0.82);
      text-transform: uppercase;
      letter-spacing: 0.14em;
      pointer-events: none;
    }

    .surv-overlay--hud {
      top: 0;
      background: linear-gradient(to bottom, rgba(2, 6, 23, 0.85), transparent);
    }

    .surv-overlay--footer {
      bottom: 0;
      background: linear-gradient(to top, rgba(2, 6, 23, 0.9), transparent);
    }

    .surv-rec {
      color: #ff4b81;
    }

    .surv-noise {
      position: absolute;
      inset: 0;
      background-image: repeating-linear-gradient(
        0deg,
        rgba(15, 23, 42, 0.4),
        rgba(15, 23, 42, 0.4) 1px,
        transparent 1px,
        transparent 2px
      );
      mix-blend-mode: soft-light;
      opacity: 0.45;
      pointer-events: none;
    }


    /* FOOTER */

    .footer {
      margin-top: 2px;
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.14em;
      text-align: center;
      opacity: 0.8;
    }

    /* STATES */

    .hidden {
      display: none !important;
    }

    .scan-complete {
      border-color: rgba(49, 242, 140, 0.9) !important;
      box-shadow: 0 0 22px rgba(49, 242, 140, 0.6);
    }

/* === CCTV Animation Upgrade (WRAFF-CAM v1.2) ===================== */

.wf-cam-container {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.wf-cam-inner {
  width: 100%;
  height: 100%;
  transform-origin: center;
  animation: wfCamDrift 14s ease-in-out infinite,
             wfCamFlicker 2.8s infinite ease-in-out;
}

.wf-cam-inner img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: brightness(0.88) contrast(1.12) saturate(0.85);
  display: block;
}

/* flicker + micro-glitch */
@keyframes wfCamFlicker {
  0%,100% { opacity: 0.96; filter: brightness(0.9) contrast(1.12); }
  48%     { opacity: 1;    filter: brightness(1.0) contrast(1.18); }
  50%     { opacity: 0.7;  filter: brightness(0.75) contrast(0.9); }
  52%     { opacity: 1;    filter: brightness(0.92) contrast(1.1); }
}

/* drift movement für echten CCTV Look */
@keyframes wfCamDrift {
  0%   { transform: scale(1.02) translate(0,0); }
  20%  { transform: scale(1.025) translate(-1%, 0.6%); }
  55%  { transform: scale(1.02) translate(1%, -0.8%); }
  80%  { transform: scale(1.03) translate(-0.4%, 0.4%); }
  100% { transform: scale(1.02) translate(0,0); }
}

/* Noise-Layer */
.wf-cam-noise-layer {
  pointer-events: none;
  position: absolute;
  inset: 0;
  opacity: 0.25;
  mix-blend-mode: soft-light;
  background-image:
    repeating-linear-gradient(
      0deg,
      rgba(17, 25, 45, 0.45) 0px,
      rgba(17, 25, 45, 0.45) 1px,
      rgba(5, 7, 12, 0.9) 1px,
      rgba(5, 7, 12, 0.9) 3px
    ),
    repeating-linear-gradient(
      90deg,
      rgba(17, 25, 45, 0.55) 0px,
      rgba(17, 25, 45, 0.55) 2px,
      transparent 2px,
      transparent 6px
    );
  animation: wfCamNoise 0.45s steps(3, end) infinite;
}

@keyframes wfCamNoise {
  0%   { transform: translate(0,0); }
  25%  { transform: translate(-1px,-1px); }
  50%  { transform: translate(1px,0); }
  75%  { transform: translate(0,1px); }
  100% { transform: translate(0,0); }
}


  </style>
</head>
<body>
  <div class="page-shell">
    <!-- TOPBAR -->
    <header class="topbar">
      <div class="topbar-left">
        <div class="logo-wrap">
          <!-- Passe den Pfad an dein Logo an -->
          <img src="Logo_trs.png" alt="WRAFF FORCE Logo">
        </div>
        <div class="topbar-title">
          <div class="topbar-title-main">WRAFF FORCE</div>
          <div class="topbar-title-sub" data-i18n="topbar_sub">K-9 DIVISION · CREDENTIAL VERIFICATION NODE</div>
        </div>
      </div>
      <div class="topbar-right">
        <div class="session-pill" id="session-pill">SESSION: K9-SESSION-0000</div>
        <div class="lang-toggle" aria-label="Language selection">
          <button class="lang-btn active" data-lang="de">DE</button>
          <button class="lang-btn" data-lang="en">EN</button>
        </div>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main-grid">
      <!-- LEFT: SCAN CONSOLE -->
      <section class="panel scan-console" id="scan-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title" data-i18n="scan_title">Credential Scan</div>
            <div class="panel-subtitle" data-i18n="scan_subtitle">
              QR input received. Initializing secure K-9 link…
            </div>
          </div>
          <span class="badge" data-i18n="scan_badge">STATUS: ACTIVE</span>
        </div>

        <div class="scan-terminal" id="scan-terminal" aria-live="polite">
          <!-- Scan lines will be appended here -->
        </div>

        <div class="scan-bar-wrapper">
          <div class="scan-bar" id="scan-bar"></div>
        </div>

        <div class="scan-terminal-footer">
          <span data-i18n="scan_footer_left">This node performs a local verification only. No data is transmitted.</span>
          <span data-i18n="scan_footer_right">WRAFF FORCE · Internal Use Only</span>
        </div>
      </section>

      <!-- RIGHT: RESULT PANEL -->
      <section class="panel result-panel hidden" id="result-panel">
        <div class="panel-header">
          <div>
            <div class="match-heading">
              <span class="match-heading-icon">✔</span>
              <span data-i18n="match_heading">MATCH FOUND – ACTIVE OPERATIVE VERIFIED</span>
            </div>
            <div class="match-subline" data-i18n="match_subline">
              Identity hash matches WRAFF FORCE K-9 registry. Operative cleared for dossier access.
            </div>
          </div>
        </div>

        <div class="mini-profile">
          <div class="mini-avatar">
            <!-- Optional: anderes Logo oder Operator-Icon -->
            <img src="Treatz.png" alt="Operative Avatar">
          </div>
          <div class="mini-meta">
            <div class="meta-row">
              <span class="meta-label" data-i18n="codename_label">CODENAME</span>
              <span class="meta-value">09-K9-OPS</span>
            </div>
            <div class="meta-row">
              <span class="meta-label" data-i18n="alias_label">CIVILIAN ALIAS</span>
              <span class="meta-value">Puppy Treatz</span>
            </div>
            <div class="meta-row">
              <span class="meta-label" data-i18n="rank_label">RANK</span>
              <span class="meta-value" data-i18n="rank_value">Paw-tenant (K-9 Field Operative)</span>
            </div>
            <div class="meta-row">
              <span class="meta-label" data-i18n="division_label">DIVISION</span>
              <span class="meta-value" data-i18n="division_value">Snack Retrieval Unit · K-9</span>
            </div>
            <div class="meta-row">
              <span class="meta-label" data-i18n="clearance_label">CLEARANCE</span>
              <span class="meta-value" data-i18n="clearance_value">WRAFF-3 · High Treat Access</span>
            </div>
            <div class="meta-row">
              <span class="meta-label" data-i18n="status_label">STATUS</span>
              <span class="meta-value" data-i18n="status_value">ON DUTY · PROBABLY NEAR THE SNACK JAR</span>
            </div>
          </div>
        </div>

        <!-- HQ SURVEILLANCE FEED -->
        <div class="surv-panel">
          <div class="surv-header">
            <div class="surv-label">HQ SURVEILLANCE FEED</div>
            <div class="surv-tag">CAM-01 // KITCHEN PERIMETER</div>
          </div>
          <div class="surv-frame">
            <div class="surv-overlay surv-overlay--hud">
              <span class="surv-rec">● REC</span>
              <span>WF-CAM-01 · 09-K9-OPS</span>
            </div>
            <div class="wf-cam-container">
  <div class="wf-cam-inner">
    <img src="hq_cam_kitchen.png"
         alt="HQ kitchen perimeter surveillance">
  </div>

  <div class="wf-cam-noise-layer"></div>
</div>

<div class="surv-overlay surv-overlay--footer">

              <span>SNACK ACCESS · FRIDGE ZONE</span>
              <span>CLASSIFIED // WF-ALPHA</span>
            </div>
            <div class="surv-noise"></div>
          </div>
        </div>


        <!-- K-9 OPS HINT -->
        <div class="ops-hint">
          <div class="ops-hint-title" data-i18n="ops_hint_title">
            K-9 OPS REMINDER
          </div>
          <div class="ops-hint-text" data-i18n="ops_hint_text">
            AUTH complete. Operative 09-K9-OPS is cleared for snack-adjacent operations.
            Please secure all treats, wag responsibly and follow standard K-9 behavior protocols.
          </div>
        </div>

        <div class="btn-row">
          <a href="dossier.html" class="btn btn-primary">
            <span class="btn-icon">⟶</span>
            <span class="btn-label" data-i18n="btn_dossier">Open Operator Dossier</span>
          </a>
          <a href="wraff_force_central.html" class="btn btn-secondary">
            <span class="btn-icon">◎</span>
            <span class="btn-label" data-i18n="btn_central">Access WRAFF FORCE Central</span>
          </a>
        </div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
      <span data-i18n="footer_line">
        INTERNAL USE ONLY · UNAUTHORIZED SNACKS WILL BE CONFISCATED BY THE K-9 UNIT.
      </span>
    </footer>
  </div>

  <script>
    // --- i18n DICTIONARY ----------------------------------------------------
    const i18n = {
      en: {
        topbar_sub: "K-9 DIVISION · CREDENTIAL VERIFICATION NODE",
        scan_title: "Credential Scan",
        scan_subtitle: "QR input received. Initializing secure K-9 link…",
        scan_badge: "STATUS: ACTIVE",
        scan_footer_left: "This node performs a local verification only. No data is transmitted.",
        scan_footer_right: "WRAFF FORCE · Internal Use Only",
        match_heading: "MATCH FOUND – ACTIVE OPERATIVE VERIFIED",
        match_subline: "Identity hash matches WRAFF FORCE K-9 registry. Operative cleared for dossier access.",
        codename_label: "CODENAME",
        alias_label: "CIVILIAN ALIAS",
        rank_label: "RANK",
        rank_value: "Paw-tenant (K-9 Field Operative)",
        division_label: "DIVISION",
        division_value: "Snack Retrieval Unit · K-9",
        clearance_label: "CLEARANCE",
        clearance_value: "WRAFF-3 · High Treat Access",
        status_label: "STATUS",
        status_value: "ON DUTY · PROBABLY NEAR THE SNACK JAR",
        ops_hint_title: "K-9 OPS REMINDER",
        ops_hint_text: "AUTH complete. Operative 09-K9-OPS is cleared for snack-adjacent operations. Please secure all treats, wag responsibly and follow standard K-9 behavior protocols.",
        btn_dossier: "Open Operator Dossier",
        btn_central: "Access WRAFF FORCE Central",
        footer_line: "INTERNAL USE ONLY · UNAUTHORIZED SNACKS WILL BE CONFISCATED BY THE K-9 UNIT."
      },
      de: {
        topbar_sub: "K-9 EINHEIT · ZUGANGS-VERIFIKATIONSNODE",
        scan_title: "Zugangsprüfung",
        scan_subtitle: "QR-Eingang registriert. Sichere K-9-Verbindung wird initialisiert…",
        scan_badge: "STATUS: AKTIV",
        scan_footer_left: "Diese Node führt nur eine lokale Verifizierung durch. Es werden keine Daten übertragen.",
        scan_footer_right: "WRAFF FORCE · Nur für den internen Gebrauch",
        match_heading: "TREFFER – AKTIVER OPERATIV-AGENT BESTÄTIGT",
        match_subline: "Identitäts-Hash stimmt mit dem WRAFF-FORCE-K-9-Register überein. Zugriff auf Dossier freigegeben.",
        codename_label: "CODENAME",
        alias_label: "BÜRGERLICHER NAME",
        rank_label: "RANG",
        rank_value: "Paw-tenant (K-9 Feldeinsatz)",
        division_label: "EINHEIT",
        division_value: "Snack Retrieval Unit · K-9",
        clearance_label: "FREIGABELEVEL",
        clearance_value: "WRAFF-3 · Hoher Snack-Zugriff",
        status_label: "STATUS",
        status_value: "IM EINSATZ · VERMUTLICH IN DER NÄHE DER LECKERLIDOSIS",
        ops_hint_title: "K-9 OPS HINWEIS",
        ops_hint_text: "AUTH abgeschlossen. Operative 09-K9-OPS ist für snack-nahe Einsätze freigeschaltet. Bitte alle Leckerlis sichern, verantwortungsvoll wedeln und die standardisierten K-9-Verhaltensprotokolle beachten.",
        btn_dossier: "Operator-Akte öffnen",
        btn_central: "WRAFF FORCE Central öffnen",
        footer_line: "NUR FÜR DEN INTERNEN GEBRAUCH · UNERLAUBTE SNACKS WERDEN VON DER K-9 EINHEIT EINKASSIERT."
      }
    };

    // Scan steps (per language)
    const scanSteps = {
      en: [
        "> INITIALIZING NODE…",
        "> HANDSHAKE WITH K-9 REGISTRY…",
        "> DECODING QR SIGNATURE…",
        "> VERIFYING HASH AGAINST WRAFF DATABASE…",
        "> CROSSCHECKING OPERATIVE STATUS…",
        "> CONFIRMING SNACK-CLEARANCE LEVEL…",
        "> FINALIZING AUTH TOKEN…",
        "> RESULT: MATCH FOUND · OPERATIVE 09-K9-OPS"
      ],
      de: [
        "> NODE WIRD INITIALISIERT…",
        "> HANDSHAKE MIT K-9-REGISTER…",
        "> QR-SIGNATUR WIRD ENTSCHLÜSSELT…",
        "> HASH-ABGLEICH MIT WRAFF-DATENBANK…",
        "> OPERATIV-STATUS WIRD GEPRÜFT…",
        "> SNACK-FREIGABELEVEL WIRD BESTÄTIGT…",
        "> AUTH-TOKEN WIRD FINALISIERT…",
        "> ERGEBNIS: TREFFER · OPERATIVE 09-K9-OPS"
      ]
    };

    let currentLang = "en";

    function detectInitialLanguage() {
      const navLang = (navigator.language || navigator.userLanguage || "en").toLowerCase();
      if (navLang.startsWith("de")) return "de";
      return "en";
    }

    function applyLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;

      const dict = i18n[lang] || i18n.en;
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (dict[key]) {
          el.textContent = dict[key];
        }
      });

      // Toggle buttons
      document.querySelectorAll(".lang-btn").forEach(btn => {
        btn.classList.toggle("active", btn.getAttribute("data-lang") === lang);
      });
    }

    function initLanguageToggle() {
      document.querySelectorAll(".lang-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const lang = btn.getAttribute("data-lang");
          applyLanguage(lang);
        });
      });
    }

    // --- Scan animation -----------------------------------------------------

    function appendScanLine(text, type = "normal") {
      const terminal = document.getElementById("scan-terminal");
      const line = document.createElement("div");
      line.className = "scan-line";

      const spanPrompt = document.createElement("span");
      spanPrompt.className = "prompt";
      const spanValue = document.createElement("span");

      if (type === "ok") spanValue.className = "value-ok";
      else if (type === "warn") spanValue.className = "value-warn";
      else if (type === "fail") spanValue.className = "value-fail";

      // Simple split: assume '> ' as prompt
      const idx = text.indexOf(">");
      if (idx !== -1) {
        spanPrompt.textContent = text.slice(0, idx + 1) + " ";
        spanValue.textContent = text.slice(idx + 1).trim();
      } else {
        spanValue.textContent = text;
      }

      line.appendChild(spanPrompt);
      line.appendChild(spanValue);
      terminal.appendChild(line);
      terminal.scrollTop = terminal.scrollHeight;
    }

    function generateSessionId() {
      const chars = "0123456789ABCDEF";
      let id = "";
      for (let i = 0; i < 4; i++) {
        id += chars[Math.floor(Math.random() * chars.length)];
      }
      return `K9-SESSION-${id}`;
    }

    function startScanAnimation() {
      const bar = document.getElementById("scan-bar");
      const scanPanel = document.getElementById("scan-panel");
      const resultPanel = document.getElementById("result-panel");
      const terminal = document.getElementById("scan-terminal");

      // Clear terminal
      terminal.innerHTML = "";

      // Start bar animation
      bar.classList.add("active");
      scanPanel.classList.remove("scan-complete");
      resultPanel.classList.add("hidden");

      const steps = scanSteps[currentLang] || scanSteps.en;
      let idx = 0;

      function nextStep() {
        if (idx < steps.length) {
          const text = steps[idx];
          let type = "normal";
          if (idx === steps.length - 1) type = "ok";
          appendScanLine(text, type);
          idx++;
          const delay = idx === steps.length ? 900 : 650;
          setTimeout(nextStep, delay);
        } else {
          // Finish
          bar.classList.remove("active");
          scanPanel.classList.add("scan-complete");
          resultPanel.classList.remove("hidden");
        }
      }

      // Small intro delay
      setTimeout(nextStep, 500);
    }

    // --- INIT ---------------------------------------------------------------

    document.addEventListener("DOMContentLoaded", () => {
      // Session ID
      const sessionId = generateSessionId();
      const pill = document.getElementById("session-pill");
      if (pill) {
        pill.textContent = `SESSION: ${sessionId}`;
      }

      // Language
      const initialLang = detectInitialLanguage();
      applyLanguage(initialLang);
      initLanguageToggle();

      // Start scan animation
      startScanAnimation();
    });
  </script>
</body>
</html>
